<!DOCTYPE html>

<html>

<head>
    <title>DeliverNow/</title>
    <meta name="author" content="Reju Pillai">
    <meta name="keywords" content="Maps,Google,HTML,CSS,JavaScript">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.js"></script>

    <!-- Step 1 : Load the Googel Maps JS API Library and specify the API_KEY (it may be chargeable) -->
    <script type="text/javascript"
        src="http://maps.google.com/maps/api/js?sensor=true&amp;libraries=geometry&amp;key=API_KEY"></script>

    <style id="compiled-css" type="text/css">
        #map {
            width: 100%;
            height: 800px;
        }
    </style>

    <script type="text/javascript">
        $(window).load(function () {

            var map, marker;
            var start_lat = "28.606649016620423"
            var start_lng = "77.23482559474752"
            var speed = 500;
            var delay = 10;
            var time_in_sec = 3600


            // Step 2 : Load the static track, the vehicle needs to traverse
            waypoint = loadtrack()
            // Step 3 : Initialize Map with start point and other params like zoom level and point of interest
            initMap();

            function initMap() {
                var myOptions = {
                    zoom: 19,
                    center: new google.maps.LatLng(start_lat, start_lng),
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    styles: [{ featureType: "poi", elementType: "labels", stylers: [{ visibility: "on" }] }]
                };
                map = new google.maps.Map(document.getElementById("map"), myOptions);
               // var iconImage = { url : "https://developers.google.com/maps/documentation/javascript/images/default-marker.png" } ;
                var iconImage = { url: "https://storage.googleapis.com/indian-truck-drivers-image/scooter_right.png" };
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(start_lat, start_lng),
                    map: map,
                    icon: iconImage
                });

                // Step 4 : Start the journey
                google.maps.event.addListenerOnce(map, 'idle', function () {
                   startJourney(marker, waypoint, speed);
                });
            }


            function startJourney(marker, coords, speed) {
                var target = 0;
                coords.push([start_lat, start_lng]);
                nextHop();

                // Inner function
                function nextHop() {
                    var lat = marker.position.lat();
                    var lng = marker.position.lng();
                    var step = (speed * delay) / time_in_sec; // in meters

                    var dest = new google.maps.LatLng(
                        coords[target][0], coords[target][1]);

                    var distance =
                        google.maps.geometry.spherical.computeDistanceBetween(
                            dest, marker.position); // in meters

                    var numStep = distance / step;
                    var i = 0;
                    var deltaLat = (coords[target][0] - lat) / numStep;
                    var deltaLng = (coords[target][1] - lng) / numStep;
                    flyMarker();

                    // Inner function
                    function flyMarker() {
                        lat += deltaLat;
                        lng += deltaLng;
                        i += step;

                        if (i < distance) {
                            from_point = marker.getPosition();
                            to_point = new google.maps.LatLng(lat, lng)
                            marker.setPosition(to_point);
                            drawPolyline(from_point, to_point)
                            setTimeout(flyMarker, delay);
                        }
                        else {
                            from_point = marker.getPosition();
                            to_point = dest;
                            marker.setPosition(to_point);
                            drawPolyline(from_point, to_point)
                            target++;
                            if (target == coords.length) { target = 0; }
                            setTimeout(nextHop, delay);

                        }

                        function drawPolyline(from, to) {
                            var edge = [from, to]
                            var polyLineOptions = { path: edge, geodesic: true, strokeColor: "#FF0000", strokeOpacity: 1.0, strokeWeight: 4 };
                            var polyline = new google.maps.Polyline(polyLineOptions);
                            polyline.setMap(map);
                        }
                    }

                }
            }




        });


        function loadtrack() {
            waypoint =
                [
                
                ["28.606649016620423", "77.23482559474752"],
                ["28.60680919677748", "77.23473240634566"],
                ["28.606969376934536", "77.2346392179438"],
                ["28.607129557091593", "77.23454602954193"],
                ["28.60728953842221", "77.23445239611279"],
                ["28.60744951975283", "77.23435876268364"],
                ["28.60760950108345", "77.2342651292545"],
                ["28.607769482414067", "77.23417149582535"],
                ["28.607929463744686", "77.2340778623962"],
                ["28.608089445075304", "77.23398422896706"],
                ["28.608249426405923", "77.23389059553791"],
                ["28.60840940773654", "77.23379696210877"],
                ["28.60856938906716", "77.23370332867962"],
                ["28.60872937039778", "77.23360969525048"],
                ["28.608889351728397", "77.23351606182133"],
                ["28.609049333059016", "77.23342242839219"],
                ["28.609209314389634", "77.23332879496304"],
                ["28.609369295720253", "77.2332351615339"],
                ["28.60952927705087", "77.23314152810475"],
                ["28.60968925838149", "77.23304789467561"],
                ["28.60984923971211", "77.23295426124646"],
                ["28.6099335448807", "77.23277328045943"],
                ["28.610017850049292", "77.23259229967239"],
                ["28.609948202551468", "77.23240340323648"],
                ["28.609878555053644", "77.23221450680056"],
                ["28.60980890755582", "77.23202561036464"],
                ["28.609739260057996", "77.23183671392873"],
                ["28.60966961256017", "77.23164781749281"],
                ["28.609599965062348", "77.2314589210569"],
                ["28.609530317564523", "77.23127002462098"],
                ["28.609523484956537", "77.23106529311026"],
                ["28.60951665234855", "77.23086056159954"],
                ["28.609509819740563", "77.23065583008882"],
                ["28.60959477432113", "77.23047524398162"],
                ["28.6096797289017", "77.23029465787441"],
                ["28.60976468348227", "77.2301140717672"],
                ["28.609849638062837", "77.22993348566"],
                ["28.609934592643405", "77.22975289955279"],
                ["28.610019547223974", "77.22957231344559"],
                ["28.610104501804543", "77.22939172733838"],
                ["28.61021364789065", "77.22922888023537"],
                ["28.610322793976756", "77.22906603313236"],
                ["28.610431940062863", "77.22890318602934"],
                ["28.61054108614897", "77.22874033892633"],
                ["28.610650232235077", "77.22857749182332"],
                ["28.610759378321184", "77.2284146447203"],
                ["28.61086852440729", "77.22825179761729"],
                ["28.610977670493398", "77.22808895051428"],
                ["28.611132864393422", "77.22798538641875"],
                ["28.611288058293447", "77.22788182232323"],
                ["28.61144325219347", "77.2277782582277"],
                ["28.611598446093495", "77.22767469413218"],
                ["28.611778307537918", "77.2276735353475"],
                ["28.61195816898234", "77.22767237656284"],
                ["28.612138030426763", "77.22767121777817"],
                ["28.612317891871186", "77.2276700589935"],
                ["28.61249775331561", "77.22766890020883"],
                ["28.61267761476003", "77.22766774142416"],
                ["28.612857476204454", "77.22766658263949"],
                ["28.613037337648876", "77.22766542385482"],
                ["28.613217015324707", "77.22767475538566"],
                ["28.61339669300054", "77.22768408691651"],
                ["28.61357637067637", "77.22769341844736"],
                ["28.6137560483522", "77.2277027499782"],
                ["28.613934766654396", "77.2277258420423"],
                ["28.61411348495659", "77.2277489341064"],
                ["28.614292203258785", "77.2277720261705"],
                ["28.614452964145876", "77.22786391619042"],
                ["28.614613725032967", "77.22795580621033"],
                ["28.61477448592006", "77.22804769623025"],
                ["28.614897307926366", "77.2281973785256"],
                ["28.614980332690465", "77.22837913538247"],
                ["28.615063357454563", "77.22856089223933"],
                ["28.61514638221866", "77.22874264909619"],
                ["28.61522940698276", "77.22892440595305"],
                ["28.615312431746858", "77.22910616280991"],
                ["28.615395456510957", "77.22928791966677"],
                ["28.615478481275055", "77.22946967652364"],
                ["28.615561506039153", "77.2296514333805"],
                ["28.61564453080325", "77.22983319023736"],
                ["28.61572755556735", "77.23001494709422"],
                ["28.61581058033145", "77.23019670395108"],
                ["28.615893605095547", "77.23037846080794"],
                ["28.615976629859645", "77.2305602176648"],
                ["28.616059654623744", "77.23074197452166"],
                ["28.616142679387842", "77.23092373137852"],
                ["28.61616842837339", "77.23112651333963"],
                ["28.616194177358935", "77.23132929530074"],
                ["28.616133701451", "77.23152225854443"],
                ["28.61607322554307", "77.23171522178812"],
                ["28.616012749635136", "77.23190818503181"],
                ["28.615952273727203", "77.2321011482755"],
                ["28.61583837886337", "77.23225972751312"],
                ["28.615724483999536", "77.23241830675074"],
                ["28.615610589135702", "77.23257688598837"],
                ["28.615514961740942", "77.23275041890338"],
                ["28.615419334346182", "77.23292395181839"],
                ["28.615323706951422", "77.2330974847334"],
                ["28.615228079556662", "77.23327101764842"],
                ["28.6151324521619", "77.23344455056343"],
                ["28.61503682476714", "77.23361808347845"],
                ["28.61494119737238", "77.23379161639346"],
                ["28.61484556997762", "77.23396514930847"],
                ["28.61474994258286", "77.23413868222349"],
                ["28.6146543151881", "77.2343122151385"],
                ["28.614626827160127", "77.23451469762303"],
                ["28.614599339132152", "77.23471718010755"],
                ["28.614571851104177", "77.23491966259208"],
                ["28.614652593154332", "77.23510274922741"],
                ["28.614733335204487", "77.23528583586274"],
                ["28.614814077254643", "77.23546892249807"],
                ["28.614894819304798", "77.2356520091334"],
                ["28.614975561354953", "77.23583509576873"],
                ["28.615056303405108", "77.23601818240407"],
                ["28.615137045455263", "77.2362012690394"],
                ["28.61521778750542", "77.23638435567473"],
                ["28.615298529555574", "77.23656744231006"],
                ["28.61537927160573", "77.2367505289454"],
                ["28.615460013655884", "77.23693361558072"],
                ["28.61554075570604", "77.23711670221606"],
                ["28.615621497756194", "77.23729978885139"],
                ["28.61570223980635", "77.23748287548672"],
                ["28.615782981856505", "77.23766596212205"],
                ["28.61586372390666", "77.23784904875738"],
                ["28.615944465956815", "77.23803213539271"],
                ["28.61602520800697", "77.23821522202805"],
                ["28.616105950057126", "77.23839830866338"],
                ["28.61618669210728", "77.23858139529871"],
                ["28.616267434157436", "77.23876448193404"],
                ["28.61634817620759", "77.23894756856937"],
                ["28.616428918257746", "77.2391306552047"],
                ["28.6165096603079", "77.23931374184004"],
                ["28.616590402358057", "77.23949682847537"],
                ["28.616671144408212", "77.2396799151107"],]


            return waypoint;

        }

    </script>

</head>

<body>
    <div id="map"></div>
</body>

</html>